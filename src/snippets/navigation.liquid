<nav id="nav" {% if section.settings.full_width_header %} class="gridlock-fluid"{% endif %}>
  
  <div id="navigation" class="row">
    <ul id="nav" class="desktop-12 mobile-3">
      {% assign menu = linklists[section.settings.main_nav] %}
      {% for link in menu.links %}

        {% assign meganav = false %}
        {% for block in section.blocks %}
          {% if block.settings.menu_item == link.title %}
            
            {% comment %} :: MEGA-MENU - WRAPPER :: {% endcomment %}
            {% capture megalink %}
              <li class="dropdown has_sub_menu" aria-haspopup="true" aria-expanded="false">


                {% comment %} :: CATEGORY HEADER :: {% endcomment %}
                <a href="{{ link.url }}" class="nav-category-header">{{ link.title }}</a>
                

                {% comment %} :: MEGA-MENU - LIST :: {% endcomment %}
                <ul class="megamenu">
                  <div class="mega-container">
                    

                    {% comment %} :: MEGA-MENU - IMAGE :: {% endcomment %}
                    {% if block.settings.nav_image != blank %}
                      <span class="desktop-3 tablet-hide mm-image">
                        <a href="{{ block.settings.nav_promo_link }}">
                          {% include 'basic-responsive-image', type: block.settings.nav_image %}
                          <noscript>
                            <img src="{{ block.settings.nav_image | img_url: '300x' }}" alt="block.settings.nav_image.alt">
                          </noscript>
                        </a>
                      </span>
                    {% endif %}


                    {% comment %} :: MEGA-MENU - LINKS :: {% endcomment %}
                    <span class="{% if block.settings.nav_image != blank %}desktop-9{% else %}desktop-12{% endif %} tablet-6">
                      
                      {% case link.links.size %}
                        {% when 0 %}
                        {% when 1 %}
                        {% assign column_width = 'desktop-12 tablet-fourth' %}
                        {% when 2 %}
                        {% assign column_width = 'desktop-6 tablet-fourth' %}
                        {% when 3 or 6 %}
                        {% assign column_width = 'desktop-4 tablet-fourth' %}
                        {% else %}
                        {% assign column_width = 'desktop-3 tablet-fourth' %}
                      {% endcase %}

                      {% comment %} :: SUB-NAV - LINKS :: {% endcomment %}
                      {% for sub_link in link.links %}
                        <li class="{{ column_width }}">
                          <h4><a href="{{ sub_link.url }}">{{ sub_link.title }}</a></h4>
                          
                          {% if sub_link.links != blank %}
                          <ul class="mega-stack">
                            {% for sub_sub_link in sub_link.links %}
                            <li><a href="{{ sub_sub_link.url }}">{{ sub_sub_link.title }}</a></li>
                            {% endfor %}
                          </ul>
                          {% endif %}
                        </li>
                      {% endfor %}
                    </span>

                  </div>
                </ul>
              </li>
            {% endcapture %}
            {% assign meganav = true %}
          {% endif %}
        {% endfor %}


{% comment %} :: RENDER : MEGA-NAV :: {% endcomment %}
        {% if meganav %}
          {{ megalink }}



{% comment %} :: PLAIN DROPDOWN (Dropdown with no megamenu) :: {% endcomment %}
        {% elsif link.links != blank %}
          
          {% comment %} :: VAR : num : Links Per Column :: {% endcomment %}
          {% assign num = section.settings.linklist_breakpoint | plus:0 %}

          {% comment %} :: VAR : numx : How many links in this list :: {% endcomment %}
          {% assign numx = linklists[link.handle].links.size %}

          {% comment %} :: VAR : numy : Number of links divided by number per column :: {% endcomment %}
          {% assign numy = numx | divided_by: num %}

          {% comment %} :: VAR : mod : Modulo balance of total links divided by links per column :: {% endcomment %} 
          {% assign mod = numx | modulo:num %}

          {% comment %} :: VAR : mod_offset : Calculate the modulo offset :: {% endcomment %} 
          {% assign mod_offset = numx | minus:mod %}

          {% comment %}
            REVIEW : 
              {{ num }}  Chosen number of links per column
              {{ numx }} Number of links in the linklist
              {{ numy }} Columns needed
              {{ mod }}  Balance for last column
              {{ mod_offset }} Links to offset before adding mod
          {% endcomment %}

          {% comment %} :: Start math for calculated multi column dropdowns :: {% endcomment %}
          <li class="dropdown has_sub_menu" aria-haspopup="true" aria-expanded="false">{{ link.title | link_to: link.url }}
            
            {% comment %} :: PLAIN DROPDOWN : Multi-Columns :: {% endcomment %}
            {% if link.links.size > num %}
    		      {% include 'navigation-columns' %}
            

            {% comment %} :: PLAIN DROPDOWN : Single Column : List small enough to fit as 1 column :: {% endcomment %}
            {% else %}
              <ul class="submenu">
                
                {% for sub_link in link.links %}
                  <li class="has_sub_menu" aria-haspopup="true" aria-expanded="false"><a href="{{ sub_link.url }}">{{ sub_link.title }}</a>
                    
                    {% if sub_link.links != blank %}
                      <ul class="nested">
                        {% for sub_sub_link in sub_link.links %}
                          <li><a href="{{ sub_sub_link.url }}">{{ sub_sub_link.title }}</a></li>
                        {% endfor %}
                      </ul>
                    {% endif %}

                  </li>
                {% endfor %}

              </ul>
            {% endif %}

          </li>


{% comment %} :: SINGLE LINK : One lonely weeb link :: {% endcomment %}
        {% else %}
          <li>{{ link.title | link_to: link.url }}</li>
        {% endif %}

      {% endfor %}
    </ul>
  </div>
</nav>


















